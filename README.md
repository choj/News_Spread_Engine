# üåé Credit Spread Screener 

Work in Progress...  

1. Start with 9 sectors and scan for catalysts across earnings, filings, flows, sentiment, ratings.

2. GPT-5 and Grok select the top 45; each. 

3. Scripts pulls live market data from the tastytrade server, and uses Black-Scholes to get PoP and ROI. 

4. GPT-5 and Grok link news and events to each spread, producing entry and exit plans.


**Need a tool or automation for your project? Hit me up, and I‚Äôll build it: stuart.alexander.phi@icloud.com**

---

# üõ† Setup Tastytrade Credentials

**`config.py`** Stores API URL and login credentials, imported and used by other scripts.

---

# ü™ê FINANCIAL MARKET RESEARCH PROMPT

## ‚óΩÔ∏è Instructions | Structure the Trading Portfolio

<img width="1360" height="862" alt="45E961EC-ECAD-43F9-AF90-7A7254DAC70B" src="https://github.com/user-attachments/assets/6b89c510-6710-49c9-b6c3-e75f61b94ddd" />

```python
# OUTPUT EXPECTED:
# Monthly refresh script ‚Äì Generated [TODAY'S DATE]
# Research period: [30 DAYS AGO] to [TODAY'S DATE]
# Generated by: [Grok 4]

OPTIMAL_45_[Grok 4] = [
    # Tier 1: Always liquid (15) ‚Äì Core positions, never remove
    "SPY", "QQQ", "IWM", "AAPL", "MSFT", "NVDA", "AMZN", "META",
    "GOOGL", "TSLA", "AMD", "NFLX", "JPM", "BAC", "XOM",

    # Tier 2: Recent earnings/event driven (15) ‚Äì Monthly rotation based on catalysts
    [15 ACTUAL TICKER SYMBOLS WITH RESEARCH RATIONALE],

    # Tier 3: Sector leaders (15) ‚Äì Stable positions, change only on major events
    [15 ACTUAL TICKER SYMBOLS WITH SECTOR LEADERSHIP JUSTIFICATION]
]

# AUTOMATIC SECTOR MAPPING ‚Äì All new tickers with GICS classifications
TICKER_SECTOR_MAP_UPDATE = {
    # Only include the 30 NEW tickers (exclude Tier 1)
    "TICKER1":  "Information Technology",
    "TICKER2":  "Health Care",
    "TICKER3":  "Consumer Discretionary",
    "TICKER4":  "Financials",
    "TICKER5":  "Energy",
    "TICKER6":  "Communication Services",
    "TICKER7":  "Industrials",
    "TICKER8":  "Materials",
    "TICKER9":  "Utilities",
    "TICKER10": "Consumer Staples",
    "TICKER11": "Real Estate",
    # Continue mapping all 30 new tickers to appropriate GICS sectors
}
```

## ‚óΩÔ∏è Prompt | Screens for News, Events, Indicators & Ratings

<img width="1362" height="863" alt="D45A1EDF-13A8-4C0F-BE63-DC04E078D07B" src="https://github.com/user-attachments/assets/dd84fa9a-1a18-46f2-a121-a7362db4ba12" />


```python
# FINANCIAL MARKETS RESEARCH ASSISTANT PROMPT
**Instructions:** Refer to instructions tab for output expected.
**Task:** Generate 45-ticker credit spread universe with automatic sector allocation
**Focus:** Publicly verifiable information only (SEC filings, earnings reports, company announcements)

---

# RESEARCH CRITERIA - HIGH CONFIDENCE TASKS ONLY
## Recent Earnings Analysis (Past 30 Days)
- Identify companies that reported earnings in the last 30 days (exact date).
- Extract headline Revenue/EPS beat or miss as stated by the company.
- Capture any management guidance updates or outlook changes stated by the company.
- Summarize quarterly performance vs. prior periods as presented by the company.
- Sources: Company earnings press releases, Form 10-Q, investor presentations (IR/SEC).

## Corporate Development Events
- Logged M&A announcements, spin-offs, or major acquisitions (company-announced).
- New product launches or market expansions (company-announced).
- Executive leadership changes (CEO/CFO transitions) announced by the company.
- Strategic partnerships or major contract wins disclosed by the company.
- Sources: Form 8-K, company press releases, investor relations pages.

## Financial Health Indicators
- Market capitalization ‚â• $1B (as of the research date; cite source and date).
- Share price ‚â• $20 at the last market close (cite source and date).
- Evidence of free cash flow generation over the last 4 quarters (from filings/IR).
- Report leverage metrics from filings (e.g., debt/equity or net debt/EBITDA) with citations.
- Sources: 10-K, 10-Q, audited financial statements, investor presentations.

## Index, Ratings, and Analyst Headlines
- Recent S&P 500 or Russell additions/deletions where formally announced.
- Current membership in major sector ETFs (e.g., SPDR) as of the research date (verify on provider site).
- Public newswire upgrade/downgrade headlines by major banks (headline/date only).
- Credit rating actions from Moody‚Äôs/S&P/Fitch (public releases).
- Sources: Index provider notices, ETF provider holdings pages, ratings-agency releases, reputable newswires.

## Sector Leadership Identification
- Moat/market-position statements supported by 10-K/annual report/IR (quote or paraphrase with page).
- Documented dividends and/or active buyback programs from IR.
- Institutional-ownership context from a reputable public aggregator (report value with source/date; no fixed threshold).
- Sources: DEF 14A (proxy), 10-K, annual reports, investor presentations, reputable ownership aggregators.

---

# VERIFICATION REQUIREMENTS - CRITICAL CONSTRAINTS
## Basic Eligibility
- Listing: Primary listing on NYSE or NASDAQ (verify via exchange/IR).
- Size & Price: Market cap ‚â• $1B and last close ‚â• $20 as of the research date (with source/date).
- Continuity: No active bankruptcy or delisting process disclosed in filings or company announcements.

## Mandatory Constraints
- Base analysis only on publicly available, verifiable sources; link and date every claim.
- If specific required information cannot be confirmed, state ‚ÄúInformation not available.‚Äù
- Include a confidence level (High/Medium/Low) for each selection.
- Cite specific sources for all claims (SEC form type + filing date; press release date/URL; ratings/index notice date).

## Prohibited Claims
- Real-time stock prices or options chains.
- Intraday volumes or technical indicators.
- Proprietary analyst price targets or paywalled research content.
- Forward-looking earnings beyond what the company has publicly guided.
- Insider trading activity or private institutional flow data.

---

# QUALITY ASSURANCE FILTERS
## Diversification Requirements
- Represent at least 8 GICS sectors in the final 45.
- No single sector exceeds 40% of selections.
- Include a mix of large-cap (>$50B) and mid-cap ($5B‚Äì$50B) names (cite size source/date).

## Recency Filters
- Prioritize companies with earnings or company-announced events in the past 30 days.
- Avoid catalysts older than 90 days unless still explicitly in effect per company disclosures.
- Prefer names with recent (‚â§90 days) public news in ratings/index/analyst-headline categories.

## Risk Screening (public-disclosure basis)
- Screen filings/news for publicly disclosed regulatory investigations; flag/exclude if confirmed.
- Screen for publicly disclosed accounting irregularities; exclude if confirmed.
- Screen for publicly disclosed major litigation milestones in the next 30 days; flag and deprioritize/exclude.
```

## ‚óΩÔ∏è Run

<img width="1366" height="864" alt="B4AB3130-1DA4-48EB-B397-59B5EDC8854E" src="https://github.com/user-attachments/assets/6715acae-1d1b-40a0-89a4-6d4b2de6a776" />


## ‚óΩÔ∏è Output | Defines the Trading Portfolio

<img width="1361" height="864" alt="93FB656F-09C1-48B6-95E9-55A94EA28194" src="https://github.com/user-attachments/assets/2cf2fcb4-936d-485d-a358-ca9dbb4a60c9" />


---


# ü§ñ FINANCIAL DATA PIPELINE

## ‚ñ™Ô∏è How to Execute 

Run `individual steps` or use the `master pipeline`

```python
# Individual steps:

python3 sectors.py
python3 build_universe.py
python3 spot.py
python3 ticker_ranker.py
python3 options_chains.py
python3 greeks.py
python3 spread_analyzer.py

# OR run everything at once:

python3 master.py
```

---

## ‚ñ™Ô∏è Run `sectors.py` Sets tickers for querying.

## ‚ñ™Ô∏è Run `build_universe.py` Tests tickers for options chains.
![60C434B5-DFAC-4E9E-B048-8507D7BDEA9E_4_5005_c](https://github.com/user-attachments/assets/a9fc8090-742e-4598-9e25-6f32a3bd832f)

## ‚ñ™Ô∏è Run `spot.py` Fetches current stock prices for strikes.
![7C22BE39-82C0-4438-95D1-732ABB5696EB_4_5005_c](https://github.com/user-attachments/assets/7dcf130c-bedc-4590-a9cf-f8a9f595ada6)

## ‚ñ™Ô∏è Run `ticker_ranker.py` Ranks stocks by options liquidity.
![23E886D2-CC47-4463-A115-5CBC1EC2DF78_4_5005_c](https://github.com/user-attachments/assets/48eed902-c9bf-42f9-a9a6-b32913656ae5)

## ‚ñ™Ô∏è Run `options_chains.py` Downloads option contracts for spreads.
![643B4579-31A7-46E8-9001-7B48B98DA684_4_5005_c](https://github.com/user-attachments/assets/1f61f824-3a2c-477e-a32d-f9e59b5b8002)

## ‚ñ™Ô∏è Run `greeks.py` Gets option prices and Greeks for PoP/ROI.
![775EAF1B-B076-4675-A230-F220EA0E90FA_4_5005_c](https://github.com/user-attachments/assets/3e1ae114-3af4-4dc8-a185-a18cb600e9b1)

## ‚ñ™Ô∏è Run `spread_analyzer.py` Builds spreads, calculates PoP/ROI, picks best.
![630A7258-6D00-4777-81A1-6A6F9CCBC977_4_5005_c](https://github.com/user-attachments/assets/67c46624-79a6-48b5-8e88-f8ed27637c74)

---

## ‚ñ™Ô∏è Run `master.py`
<img width="901" height="524" alt="D4F660FE-D30F-43DE-8797-44EC3239E386" src="https://github.com/user-attachments/assets/a6becac3-2309-4129-bce4-86c2edada464" />

---


# üíØ Generate Strategy and Game Plan

## ‚ñ™Ô∏è Prompt for Report with Catalyst Heat, Bias, and Trade Plan.


### ‚óΩÔ∏è GROK 4 & ChatGPT 5 (input)
```python
# Credit Spread Analysis & Trade Ranking Prompt

You are analyzing real credit spread opportunities with live options data. Your task is to score, rank, and generate actionable trade plans from the algorithm output.

## FOUNDATION (9 Analysis Points)

1. **Risk-Reward Validation:** Calculate R:R = Net_Credit / (Width - Net_Credit). Require R:R ‚â• 0.33 minimum for inclusion.

2. **Probability Assessment:** Evaluate PoP in context - 50-55% acceptable for high ROI, 60%+ preferred for conservative plays. Flag any PoP < 50% as speculative.

3. **Distance Buffer Analysis:** Classify Distance_From_Current: <0.5% = "thin", 0.5-2% = "adequate", >2% = "conservative". Prefer adequate+ for entry.

4. **DTE Optimization:** Score by timeframe: 7-21 DTE = optimal (+10 points), 22-33 = good (+5 points), 34-45 = acceptable (0 points), <7 = gamma risk (-10 points).

5. **Width Efficiency:** Evaluate spread width: $1-2 = narrow, $3-5 = sweet spot (+5 points), $6-10 = wide, >$10 = unwieldy (-5 points).

6. **ROI Reality Check:** Cap ROI analysis at 150% (higher often indicates thin liquidity). Score: >100% = excellent (+10), 75-100% = good (+5), 50-75% = fair (0), <50% = poor (-5).

7. **Sector Concentration:** Limit exposure - maximum 2 positions per sector, prefer diversification across 6+ sectors.

8. **Directional Consistency:** Group by bias - bull puts for bullish outlook, bear calls for bearish. Flag any directional mismatches for review.

9. **Liquidity Inference:** Favor large-cap tickers (GOOGL, JPM, UNH over smaller names) and standard strike intervals for better fills.

## PROCESS (6 Execution Steps)

**1. Data Validation & Cleaning:**
- Verify all numeric fields are properly formatted
- Flag any missing or suspicious data points
- Calculate derived metrics: Width = |Short - Long|, Max_Loss = Width - Net_Credit, R:R ratio

**2. Multi-Factor Scoring:**

Base_Score = PoP + (ROI_capped √ó 0.35) + (Distance_Buffer √ó 8) + DTE_bonus + Width_bonus + ROI_bonus
- PoP: Raw percentage (50-70 typical range)
- ROI_capped: min(ROI, 150) √ó 0.35 factor  
- Distance_Buffer: Percentage √ó 8 multiplier
- DTE_bonus: +10 (7-21), +5 (22-33), 0 (34-45), -10 (<7)
- Width_bonus: +5 ($3-5 width), -5 (>$10 width)
- ROI_bonus: +10 (>100%), +5 (75-100%), -5 (<50%)


**3. Risk Categorization:**
- **GREEN (Enter):** Score >80, PoP >50%, Distance >0.5%, R:R >0.33
- **YELLOW (Watch):** Score 65-80 or thin buffer but otherwise qualified
- **RED (Avoid):** Score <65, PoP <50%, or Distance <0.3%

**4. Portfolio Construction:**
- Select top 1-2 trades per sector maximum
- Ensure bull/bear balance reflects market outlook
- Prioritize diversification over individual trade perfection

**5. Entry Timing & Catalysts:** 
- Cross-reference with recent news/earnings calendar
- Identify immediate entries vs. watchlist candidates
- Note any time-sensitive catalysts

**6. Risk Management Framework:**
- Set profit targets: 25-50% of credit received
- Define stop losses: Technical breaks or 2x credit received
- Position sizing: 1-3% portfolio risk per trade maximum

## OUTPUT (3 Deliverables)

**1. Ranked Trade Table:**

| Rank | Ticker | Type | Strikes | DTE | PoP | ROI | Action | Risk Level |
|------|--------|------|---------|-----|-----|-----|-----|--------|-------
| 1    | JPM    | Bear Call | $300/$305 | 25 | 55.4% | ENTER | GREEN |


**2. Portfolio Allocation Plan:**
.json
{
  "total_recommendations": 15,
  "immediate_entries": 8,
  "watchlist": 5,
  "rejected": 2,
  "sector_breakdown": {
    "Financials": {"positions": 2, "allocation": "25%"},
    "Technology": {"positions": 2, "allocation": "25%"},
    "Healthcare": {"positions": 2, "allocation": "25%"}
  },
  "risk_metrics": {
    "total_margin_required": "$estimated",
    "max_loss_per_trade": "$calculated", 
    "portfolio_beta": "estimated_exposure"
  }
}


**3. Build a Individual Trade Plans Table:**
{
  "ticker": "JPM",
  "trade_summary": "Bear call spread $300/$305, 25 DTE",
  "entry_criteria": {
    "trigger": "On strength above $295",
    "max_entry_price": "$2.20 credit",
    "ideal_timing": "First 2 hours of trading"
  },
  "profit_management": {
    "target_1": "25% credit ($0.55) - close 50% position", 
    "target_2": "50% credit ($1.10) - close remainder",
    "max_hold": "21 DTE or 50% credit, whichever first"
  },
  "risk_management": {
    "stop_loss": "Break above $302 or 2x credit loss ($4.40)",
    "technical_stop": "Daily close above $303",
    "time_stop": "7 DTE - evaluate for roll or close"
  },
  "market_context": "Financials bullish on rate environment",
  "position_size": "1-2% portfolio risk maximum"
}


## EXECUTION PRIORITIES

**Immediate Action (GREEN trades):**
- Score >80 with adequate buffer
- Enter on next favorable market conditions
- Monitor for optimal entry timing

**Watchlist (YELLOW trades):**
- Good setups waiting for better entry
- Thin buffer requiring pullback/rally
- Monitor for improved risk-reward

**Avoid (RED trades):**
- Poor risk-reward metrics
- Insufficient probability of profit  
- Too close to current price

## CRITICAL RULES

- **No trade with PoP < 50%** - probability must favor credit spread seller
- **Minimum 0.5% buffer** unless exceptional ROI (>120%) and PoP (>65%)
- **R:R ratio ‚â• 0.33** - risk management fundamental
- **Maximum 2 positions per sector** - diversification requirement
- **Cap analysis at realistic ROI** - avoid thin liquidity traps
- **Time decay preference** - favor 7-21 DTE sweet spot
- **Position sizing discipline** - never exceed 3% portfolio risk per trade

**Success Target:** Generate 10-15 executable credit spreads with >65% aggregate probability of profit and proper portfolio risk management.

**Quality Standard:** Each recommendation must include specific entry criteria, profit targets, stop losses, and position sizing guidance based on real options data provided.
```
